---
title: "自社にとって最適なデプロイを突き詰める"
authors: [
    ["Hiroyuki Kinoshita",""],
    ["Tsubasa Yoshino",""]
]
weight: 10
date: 2019-08-18
description: 自社にとって最適なデプロイを突き詰める
type : "article"
keywords:
  - "word1"
  - "word2"
  - "word3"
eyecatch: "images/deploy.png"
---

## 業務上の背景

### 事業内容

- 別途記載(2019年の蛎殻町)

### DevOps周りで起きる困りごととは何か

- 手動デプロイだとVisual Studioからステージング環境に本番設定でデプロイできてしまう等、トラブルを稀に起こす。
- 現環境が、誰がいつデプロイしたのか良くわからないことがある。今起きている事象とデプロイとの相関性が把握しにくい。
- ステージングで動作確認しても、久しぶりの本番デプロイが怖い。
- トラブルに伴い、一度すぐロールバックできるようにして、リリース時のトラブル軽減に加えて心理的な安全を確保したい。

### デプロイと運用監視の専任を立てるべきか

- PaaSやサーバーレス中心の中、デプロイやインフラ専門職を用意したいか？
- その人に全部片づけてほしいか？例えば、その人にいくら給与を払いたいか。
- 任せられるなら任せたい。コードに集中したい。 という意見もあったが、
- プロジェクトの機能を実装しながら、ログの管理、構成管理、セキュリティ管理、今は自分達でも短い時間で出来る量。ただプロジェクトの佳境で並行して設定するのは大変。

インフラは専任にお任せというのは一昔前の話で、非機能要件もコントロールできてこそ、強いクラウドネイティブエンジニアでは？
という意見もあり、楽はしたいものの、専任を立てず自分でコントロールする方が望んでいる人が多く、現状は、経済的効果でデプロイと運用監視の選任は立てないこととなった。(専任が必要になるラインは近いかもしれないとは考えておく。)

## (今のベストプラクティス)AzureDevOpsでまとめる

一番イケてると思われるやり方を公開し、公開したコンテンツをアップデートしていくことによって維持する。

### なぜAzure DevOpsを選んだのかシステム的な理由

- 楽だから。ポチポチしてパイプラインを作ると出来上がる。
- Azureと親和性が高い。
- .NETCoreを使うとほぼ間違いがない。
- VSからアップロードしない世界になる。
- 任意のバージョンに戻せるようにして、心理的な安全を確保。
- 情報を公開して、楽になりたい人が使っていく、後の人も楽だから。
- 途中から実装手伝いで入っても、デプロイは意識せずに済む。

### 運用を含めたメリット

- 客がデプロイのフローに参加できる。
- デプロイ承認を顧客が実施することにより、相手に検収という行為をしてほしい。
- 適切に改修した責任をシェアしたい。※改修内容をちゃんと確認しない顧客もいる。

### AzureDevOpsの課題

- リポジトリが１つの時に１コミットで全部が回っちゃってAzureDevOpsがつまっちゃう。
- ソリューションファイルがたくさんある
- チャットオプスつかう?
- プロジェクト立ち上げ時に簡単に環境構築できるのが良い
- 1プロジェクト　1リポジトリ？
- GitTagとか使う
- Dev環境は面倒

### AzureDevOpsの使い方

- 書く
- ビルドとリリースの使い方わけ
- テストプロジェクトを指定して回すことはできる

### 必要なことやTODO(残課題)

- yaml設定ファイルのジェネレーターを作る？
- yamlの面倒を見るのはだれか＝新しい方法が出たときのアップデート(.NET Core 3.0)
- テストを書くことと回すことは違う
- プロジェクト単位でワークスペースを分ける？？
- 式年遷宮の話、88か所巡りをしている間に新しくなるような形が望ましい。(方法は検討)
