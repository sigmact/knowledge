---
title: "自社にとって最適なデプロイを突き詰める"
authors:
  [
    ["Hiroyuki Kinoshita", "images/author/kinoshita.png"],
    ["Tsubasa Yoshino", "images/author/yoshinotsubasa.jpg"],
  ]
weight: 10
date: 2020-03-31
description: "弊社では少数精鋭によるパブリッククラウドを利用した SI の提供を前提とした DevOps に取り組んでいます。取り組みの中では弊社にとってベストプラクティスに到達している要素もあれば、継続的に検証と改善を繰り返している要素もあり、まだまだ未成熟な状態です。"
type: "article"
draft: true
eyecatch: "images/eyecatch/deploy.png"
---

## はじめに

本稿では弊社で取り組んでいる DevOps について記載します。DevOps 自体には厳密に明確な定義はありませんので、DevOps の手法については取り組んでいる組織や環境によって様々だと思います。弊社では少数精鋭によるパブリッククラウドを利用した SI の提供を前提とした DevOps に取り組んでいます。取り組みの中では弊社にとってベストプラクティスに到達している要素もあれば、継続的に検証と改善を繰り返している要素もあり、まだまだ未成熟な状態です。数年間実務で取り組んできた弊社の DevOps はどういった観点でどのような取り組みを実施しているのか、整理も含めて本稿でまとめていきます。

## 業務上の背景

弊社ではパブリッククラウド、特に Microsof Azure を中心に SI を展開しています。業務内容の詳細は後述しますが、主幹として EC 業務を中心に様々な SI に従事しています。基本的にビジネス速度が早く業務改善や新規施策等の PDCA サイクルを短期的に回すことの多い業務を得意としています。

弊社は少数精鋭でプロジェクトを進めることが多いので開発者と運用者を組織的に分けるということはしていません。開発者=運用者と捉えることもできると思います。少数精鋭で組織や役割の区分けもなく開発効率や運用効率が求められるとなれば必然的に DevOps を導入することになります。ここで先にも述べた通り開発者と運用者の区別がないのが弊社の特徴になります。その他の特徴としてリモートワーク推奨、サテライトオフィスの設置を行っているためプロジェクトメンバーが点在している環境で開発や運用をすすめているのも大きな特徴です。

弊社の特徴をふまえると世間一般でいわれている DevOps の組織的なメリットにはあてはまりません。マーケティング、営業、開発、運用のように組織が分かれている場合はそれぞれの組織に対する不満や KPI 等に振り回されることが多いと思いますが少数である弊社では社員同士のつながりで解決できることが多いです。
なぜかというと DevOps の本質であるメンタル要素を社内でチームビルディングしながら素養として社員ごとに培っているからです。そうすることで社員同士のつながりで相乗効果を上げながら問題を解決することができ組織文化の発展にもつながります。どうやって培っているかについては特殊すぎるのでここでは言及しませんが、弊社の CEO の Tiwtter をフォローしてもらえればわかることが多いと思います。

- Respect : 相手のことを思いやる
- Trust : メンバーを信頼する
- Healthy attitude about failure : 失敗は起きるものとしてとらえる
- Avoiding Blame : ミスが起きたとしても担当者を責めない

弊社は下記にあげる生産や効率に特化した DevOps の基本性質を業務に取り込んでいます。フィードバックループを高速化することに主軸をおきつつ回復性とリスク分散による心理的安全性を担保するための取り組みを行っています。

- リリースの高速化
- 生産性の向上
- リスクの分散
- 円滑な情報共有

これらを踏まえて**「冪等性」**による担保を加えるようにしています。
冪等性とは「同じ操作を何度繰り返しても、同じ結果が得られる性質」です。
冪等性を担保することで誰が操作しても同じ結果を常に得られるように環境を構築しておけばリスク回避につながります。
例えば In-Place Deployment によるプログラムリソースの上書きデプロイを本番環境に行うとした時、作業者の心理的負担と障害が発生した時のリスクは計り知れないものとなります。容易にロールバックできる環境を用意し切り戻しができる安心感と障害時間の最小化に務めるべきでしょう。この操作を誰が行っても問題が起きないように担保するために弊社では Azure DevOps を採用しています。

Devops には正解がないのでそれぞれの組織、プロジェクト、チームにとって常に最適解を探模索する必要があります。
最適解の模索を DevOps を育成すると表現している方もいらっしゃいますがまさにその通りだと思います。
本稿で弊社が育んできた DevOps の組織的文化を紹介できればと思います。

### 開発と運用と DevOps

<!--
Keyword
運用でポカしない＝心理的安全性
運用でポカすると無駄な作業が増える＝効率化
誰がやっても＝べきとうせい
承認制＝責任の冗長化
自動テスト
-->

弊社の社員は複数の運用案件に従事しながら１つの開発案件に従事しているケースが多いです。
これは弊社だけではなく世間の SIer に多い座組だと思います。
ただ、弊社の場合はそういった座組を少数精鋭で回していく必要があるため、より生産性の向上と効率化が求められます。
ここでは開発と運用が錯綜する状況下でどのように DevOps に取り組んでいるかについて説明します。

Project Manager として従事する筆者の視点でいうと DevOps は RPG ゲームでいうところの補助魔法だと思います。少数精鋭で開発を進めるためには開発者の開発効率を最大限引き上げる必要があります。そのためにはインフラ構築やマニュアルデプロイ等の省ける作業は極力省いていかなくてはなりません。
開発効率をあげて生産性の向上をはかる　 → 　 FB ループのサイクルを上げることで効率よく品質を高めていく

![開発時](../images/images02.png)

運用面での効果

運用作業でミスを減らす　 → 　運用作業をミスると無駄な作業が増えるため極力減らす　＋　ミスを減らせばお客の心象もよくなる
誰が操作しても同じ結果を得られるようにする　 → 　心理的安全性を持つ　 → 　ここには課題がある
責任の分散化を行う（承認制を導入して確認者を増やしてリスクを減らす）

![運用時](../images/images02.png)

### なぜ Azure DevOps を選んだのかシステム的な理由

数ある DevOps ツールの中で弊社では Azure DevOps を選択し利用しています。もともと Azure をベースとした SI やサービス展開を行っているため、Azure との親和性の高さやとっつきやすさから利用を開始ししました。

また、Azure DevOps には Boards によるプロジェクト管理、Repos によるリポジトリ管理、Pipelines による CI/CD 管理と DevOps に必要なサービスがすべて用意されている事も選択要因のひとつになります。Visual Studio MarketPlace で Extension が配布されているので機能の拡充もしやすいです。

### AzureDevOps の使い方

##### OverView

- Summary
- Dashboards
- Wiki

##### Boards

- WorkItems
- Boards
- Backlogs
- Sprints
- Queries

##### Repos

- Files
- Commits
- Pushes
- Branches
- Tags
- PullRequests

##### PipeLines

- Builds
- Release
- Library
- TaskGroups
- DeploymentGroups

##### Test Plan

- TestPlans
- Prpgressreport
- Parameters
- Configurations
- Runs

#### Artifacts

<!--
### 必要なことや TODO(残課題)

- yaml 設定ファイルのジェネレーターを作る？
- yaml の面倒を見るのはだれか＝新しい方法が出たときのアップデート(.NET Core 3.0)
- テストを書くことと回すことは違う
- プロジェクト単位でワークスペースを分ける？？
- 式年遷宮の話、88 か所巡りをしている間に新しくなるような形が望ましい。(方法は検討)

### 参考

１：CICD を使用する理由
２：世の中にある CICD ツールの紹介（できれば比較も）
３：AzureDevOps を選択する理由
４：AzureDevOps の機能について説明・使い方
組織 → プロジェクト概念
Agent/AgentLess とか設定周りとか全体的を踏まえつつ機能を深堀
ここは機能ごとに別の章立てのほうがいいかもしれない。
５：Azure との連携
６：オリジナルタスクを作成して公開する
-->
